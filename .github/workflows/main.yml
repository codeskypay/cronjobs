name: sirtheprogrammer

on:
  schedule:
    - cron: "0 7,9,12,13,14 * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  auto_commit:
    runs-on: ubuntu-latest
    env:
      TZ: Africa/Dar_es_Salaam
      CRONITOR_URL: https://cronitor.link/p/ecb2ddbcc7f44884bb75c6d9bddc2b19/important-job

    steps:
      - name: ğŸ”” Cronitor â†’ RUN
        run: |
          curl -fsS "${CRONITOR_URL}?state=run" || true

      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ•’ Update marker
        run: |
          date '+%Y-%m-%d %H:%M:%S %Z' > LAST_UPDATED

      - name: ğŸ”§ Git setup
        run: |
          git config user.name "auto-bot"
          git config user.email "auto-bot@users.noreply.github.com"

      - name: ğŸ² Auto commits
        run: |
          msgs=("ğŸ¤– auto sync" "ğŸš€ keep alive" "ğŸ‘» ghost commit" "ğŸ legendary")
          n=$((RANDOM % 5 + 2))

          for ((i=1;i<=n;i++)); do
            echo "update $i $(date)" > file_$i.txt
            git add -A
            git commit -m "${msgs[RANDOM % ${#msgs[@]}]}" || true
            sleep $((RANDOM % 4 + 1))
          done

      - name: ğŸš€ Push
        run: git push origin main

      - name: âœ… Cronitor â†’ COMPLETE
        if: success()
        run: |
          curl -fsS "${CRONITOR_URL}?state=complete" || true

      - name: âŒ Cronitor â†’ FAIL
        if: failure()
        run: |
          curl -fsS "${CRONITOR_URL}?state=fail" || true
